<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Fixed Blockly</title>
  <script src="../../blockly_compressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../msg/js/en.js"></script>
  <script src="tinyscript.js"></script>
  <script src="../../generators/tinyscript.js"></script>
  <script src="../../generators/tinyscript/tinyscript.js"></script>
</head>
<body style="margin: 0 0 0 0">
  <div id="blocklyDiv" style="height: 100vh; width: 100%;"></div>

<xml xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
  <category name="Logic" colour="#5b80a5">
    <block type="controls_if"></block>
    <block type="logic_compare">
      <field name="OP">EQ</field>
    </block>
    <block type="logic_operation">
      <field name="OP">AND</field>
    </block>
    <block type="logic_negate"></block>
    <block type="logic_boolean">
      <field name="BOOL">TRUE</field>
    </block>
    <block type="logic_null"></block>
  </category>
  <category name="Text" colour="#5ba593">
    <block type="text">
      <field name="TEXT"></field>
    </block>
    <block type="text_join">
      <mutation items="2"></mutation>
    </block>
  </category>
  <category name="I/O" colour="#006677">
	<block type="read_input"></block>
	  <block type="text_print">
		  <value name="TEXT">
			<shadow type="text">
			  <field name="TEXT">abc</field>
			</shadow>
		  </value>
	  </block>
  </category>
  <category name="Loops" colour="#6da55b">
    <block type="count">
      <field name="variable" id="Ef3k:l_yLPWqVGvBY+~@" variabletype="">variable</field>
      <field name="initial">0</field>
      <field name="until">0</field>
      <field name="direction">increment</field>
      <field name="inc_value">0</field>
    </block>
    <block type="for">
      <field name="variable1" id="{2{^2U%R!^4zD56k${sA" variabletype="">i</field>
      <field name="asd">increment</field>
      <field name="variable2" id="{2{^2U%R!^4zD56k${sA" variabletype="">i</field>
    </block>
    <block type="while"></block>
    <block type="do_while"></block>
  </category>
  <category name="Math" colour="#5b5ba5">
    <block type="math_number">
      <field name="NUM">0</field>
    </block>
    <block type="math_arithmetic">
      <field name="OP">ADD</field>
      <value name="A">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
      <value name="B">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
    </block>
    <block type="abs"></block>
	<block type="maximum_select">
		<field name="variable" id="~z(At[qO`1T5RRP0e?~]" variabletype="">item</field>
	</block>
  </category>
  <category name="Variables" colour="#a55b6d">
    <block type="create_var">
      <field name="var" id="hZrAa$}ngjD(C!r)8kJC" variabletype="">myVariable</field>
      <value name="NAME">
        <shadow type="math_number">
          <field name="NUM">0</field>
        </shadow>
      </value>
    </block>
    <block type="create_variabletype">
      <field name="type">int</field>
      <field name="var" id="hZrAa$}ngjD(C!r)8kJC" variabletype="">myVariable</field>
    </block>
    <block type="variables_set">
      <field name="VAR" id="hZrAa$}ngjD(C!r)8kJC" variabletype="">myVariable</field>
    </block>
    <block type="math_change">
      <field name="VAR" id="hZrAa$}ngjD(C!r)8kJC" variabletype="">myVariable</field>
      <value name="DELTA">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
    </block>
    <block type="variables_get">
      <field name="VAR" id="hZrAa$}ngjD(C!r)8kJC" variabletype="">myVariable</field>
    </block>
  </category>
    <category name="Array" colour="#a5a55b">
    <block type="create_array">
      <field name="type">int</field>
      <field name="name" id="d~Q/Z/T_,x[FQmdrnJ(u" variabletype="">myArray</field>
	  <value name="size">
		  <shadow type="math_number">
			<field name="NUM">0</field>
		  </shadow>
      </value>
    </block>
  <block type="set_array">
    <field name="item" id="5jbX?[CAot60T2!AXb~t" variabletype="">item</field>
    <value name="index">
      <shadow type="math_number">
        <field name="NUM">0</field>
      </shadow>
    </value>
	    <value name="value">
      <shadow type="math_number">
        <field name="NUM">0</field>
      </shadow>
    </value>
  </block>
  <block type="get_array">
    <field name="variable" id="~z(At[qO`1T5RRP0e?~]" variabletype="">item</field>
    <value name="index">
      <shadow type="math_number">
        <field name="NUM">0</field>
      </shadow>
    </value>
  </block>
  <block type="init_array">
  </block>
  </category>
</xml>

  <script>
   var generatedCode;
   var generatedXml;
    var workspace = Blockly.inject('blocklyDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox'),
		 zoom: {
            controls: true,
            wheel: true,
            startScale: 1,
            maxScale: 1.5,
            minScale: 0.5,
            scaleSpeed: 1.2
        }
		 });
		 
    function showCode() {
      // Generate TinyScript code
      Blockly.TinyScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.TinyScript.workspaceToCode(workspace);
	  generatedCode = code;
    }
	
	function clearWorkspace(){
	    if (Blockly.mainWorkspace !== null) {
            Blockly.mainWorkspace.clear();
        }
	}
	
	function saveBlocks() {
		Blockly.TinyScript.INFINITE_LOOP_TRAP = null;
        var xml = Blockly.Xml.workspaceToDom(workspace);
        generatedXml = Blockly.Xml.domToPrettyText(xml);
    }
	
	function loadBlocks(xml){
		clearWorkspace();
		var dom = Blockly.Xml.textToDom(xml);
        Blockly.Xml.domToWorkspace(workspace, dom);
	}
	
	function onChange(){
		window.external.onChanged();
	}
	
	workspace.addChangeListener(onChange);

	
  </script>

</body>
</html>
