<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockly GPIO ZERO LIB</title>

    <!--Blockly related-->
    <script src="blockly_handler.js"></script>
    <script src="blockly_user_handler.js"></script>
    <script src="blockly_compressed.js"></script>
    <script src="blocks_compressed.js"></script>
    <script src="python_compressed.js"></script>
    <script src="en.js"></script>

    <!--GPIO Zero related-->
    <script src="gz_code_gen_python.js"></script>
    <script src="block_def_gz_bool.js"></script>
    <script src="block_def_gz_complex.js"></script>
    <script src="block_def_gz_init.js"></script>
    <script src="block_def_gz_set_const.js"></script>
    <script src="block_def_gz_set_var.js"></script>
    <script src="block_def_gz_util.js"></script>
    <script src="block_def_gz_value.js"></script>
    <script src="block_def_gz_wait.js"></script>


    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            background-color: #fff;
            font-family: sans-serif;
            overflow: hidden;
        }

        h1 {
            font-weight: normal;
            font-size: 140%;
        }

        table {
            height: 100%;
            width: 100%;
        }

        td, tr {
            border: 1px solid black;
        }

        #blocklyArea {
            height: 99%;
        }
    </style>
</head>
<body>
<table>
    <tr>
        <td>
            <h1>
                GPIOZERO Demo</h1>
        </td>
    </tr>
    <tr>
        <td>
            <p>
                <button onclick="generateCode()">Generate Python and Save</button>
                <button onclick="saveBlocks()">Save Blocks for later use</button>
            </p>
            <p>
                Load Blocks from XML file:
                <input type="file" id="file-input"/>
            </p>
            <p>
                <button onclick="connectSSH(document.getElementById('ip-and-port').value)">Upload to pi and run</button>
                <input type="text" id="ip-and-port" placeholder="localhost:8080"/>
            </p>
        </td>

    </tr>

    <tr>
        <td id="blocklyArea">
        </td>
        <td>
            <textarea style="width: 100%; height: 100%;" readonly id="on-the-fly-code-textarea"></textarea>
        </td>
    </tr>
</table>

<div id="blocklyDiv" style="position: absolute"></div>

<!--Toolbox-->
<div xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
    <category name="Logic" colour="#5C81A6">
        <block type="controls_if"></block>
        <block type="logic_compare">
            <field name="OP">EQ</field>
        </block>
        <block type="logic_operation">
            <field name="OP">AND</field>
        </block>
        <block type="logic_negate"></block>
        <block type="logic_boolean">
            <field name="BOOL">TRUE</field>
        </block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
    </category>
    <category name="Loops" colour="#5CA65C">
        <block type="controls_repeat_ext">
            <value name="TIMES">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
        </block>
        <block type="controls_whileUntil">
            <field name="MODE">WHILE</field>
        </block>
        <block type="controls_for">
            <field name="VAR" id="#AG-5qqIN9Fg,e#j,%Fn" variabletype="">i</field>
            <value name="FROM">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="TO">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
            <value name="BY">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
        </block>
        <block type="controls_forEach">
            <field name="VAR" id="Q2C0yCN}%KW`=O5E1TDd" variabletype="">j</field>
        </block>
        <block type="controls_flow_statements">
            <field name="FLOW">BREAK</field>
        </block>
    </category>
    <category name="Math" colour="#5C68A6">
        <block type="math_number">
            <field name="NUM">0</field>
        </block>
        <block type="math_arithmetic">
            <field name="OP">ADD</field>
            <value name="A">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="B">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
        </block>
        <block type="math_single">
            <field name="OP">ROOT</field>
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">9</field>
                </shadow>
            </value>
        </block>
        <block type="math_trig">
            <field name="OP">SIN</field>
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">45</field>
                </shadow>
            </value>
        </block>
        <block type="math_constant">
            <field name="CONSTANT">PI</field>
        </block>
        <block type="math_number_property">
            <mutation divisor_input="false"></mutation>
            <field name="PROPERTY">EVEN</field>
            <value name="NUMBER_TO_CHECK">
                <shadow type="math_number">
                    <field name="NUM">0</field>
                </shadow>
            </value>
        </block>
        <block type="math_round">
            <field name="OP">ROUND</field>
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">3.1</field>
                </shadow>
            </value>
        </block>
        <block type="math_on_list">
            <mutation op="SUM"></mutation>
            <field name="OP">SUM</field>
        </block>
        <block type="math_modulo">
            <value name="DIVIDEND">
                <shadow type="math_number">
                    <field name="NUM">64</field>
                </shadow>
            </value>
            <value name="DIVISOR">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
        </block>
        <block type="math_constrain">
            <value name="VALUE">
                <shadow type="math_number">
                    <field name="NUM">50</field>
                </shadow>
            </value>
            <value name="LOW">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="HIGH">
                <shadow type="math_number">
                    <field name="NUM">100</field>
                </shadow>
            </value>
        </block>
        <block type="math_random_int">
            <value name="FROM">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="TO">
                <shadow type="math_number">
                    <field name="NUM">100</field>
                </shadow>
            </value>
        </block>
        <block type="math_random_float"></block>
    </category>
    <category name="Text" colour="#5CA68D">
        <block type="text">
            <field name="TEXT"></field>
        </block>
        <block type="text_join">
            <mutation items="2"></mutation>
        </block>
        <block type="text_append">
            <field name="VAR" id="Qd6[tD1lK%{O7:zm.CWJ" variabletype="">item</field>
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
        </block>
        <block type="text_length">
            <value name="VALUE">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_isEmpty">
            <value name="VALUE">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
        </block>
        <block type="text_indexOf">
            <field name="END">FIRST</field>
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR" id="0}}[Y~Ur.`+FbJ,.%]Ch" variabletype="">text</field>
                </block>
            </value>
            <value name="FIND">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_charAt">
            <mutation at="true"></mutation>
            <field name="WHERE">FROM_START</field>
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR" id="0}}[Y~Ur.`+FbJ,.%]Ch" variabletype="">text</field>
                </block>
            </value>
        </block>
        <block type="text_getSubstring">
            <mutation at1="true" at2="true"></mutation>
            <field name="WHERE1">FROM_START</field>
            <field name="WHERE2">FROM_START</field>
            <value name="STRING">
                <block type="variables_get">
                    <field name="VAR" id="0}}[Y~Ur.`+FbJ,.%]Ch" variabletype="">text</field>
                </block>
            </value>
        </block>
        <block type="text_changeCase">
            <field name="CASE">UPPERCASE</field>
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_trim">
            <field name="MODE">BOTH</field>
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_print">
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_prompt_ext">
            <mutation type="TEXT"></mutation>
            <field name="TYPE">TEXT</field>
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
    </category>
    <category name="Lists" colour="#745CA6">
        <block type="lists_create_with">
            <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with">
            <mutation items="3"></mutation>
        </block>
        <block type="lists_repeat">
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">5</field>
                </shadow>
            </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
            <field name="END">FIRST</field>
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR" id="6spC0;V!=:as;_[n~2m}" variabletype="">list</field>
                </block>
            </value>
        </block>
        <block type="lists_getIndex">
            <mutation statement="false" at="true"></mutation>
            <field name="MODE">GET</field>
            <field name="WHERE">FROM_START</field>
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR" id="6spC0;V!=:as;_[n~2m}" variabletype="">list</field>
                </block>
            </value>
        </block>
        <block type="lists_setIndex">
            <mutation at="true"></mutation>
            <field name="MODE">SET</field>
            <field name="WHERE">FROM_START</field>
            <value name="LIST">
                <block type="variables_get">
                    <field name="VAR" id="6spC0;V!=:as;_[n~2m}" variabletype="">list</field>
                </block>
            </value>
        </block>
        <block type="lists_getSublist">
            <mutation at1="true" at2="true"></mutation>
            <field name="WHERE1">FROM_START</field>
            <field name="WHERE2">FROM_START</field>
            <value name="LIST">
                <block type="variables_get">
                    <field name="VAR" id="6spC0;V!=:as;_[n~2m}" variabletype="">list</field>
                </block>
            </value>
        </block>
        <block type="lists_split">
            <mutation mode="SPLIT"></mutation>
            <field name="MODE">SPLIT</field>
            <value name="DELIM">
                <shadow type="text">
                    <field name="TEXT">,</field>
                </shadow>
            </value>
        </block>
        <block type="lists_sort">
            <field name="TYPE">NUMERIC</field>
            <field name="DIRECTION">1</field>
        </block>
    </category>
    <sep></sep>
    <category name="Variables" colour="#A65C81" custom="VARIABLE"></category>
    <category name="Functions" colour="#9A5CA6" custom="PROCEDURE"></category>
    <sep></sep>
    <category name="GZ - util" colour="#a55b5b">
        <block type="gpioportnumber">
            <field name="PORT">2</field>
        </block>
        <block type="pause"></block>
        <block type="sleep">
            <field name="sleepTime">0</field>
        </block>
        <block type="sleepvariable"></block>
    </category>
    <category name="GZ - init" colour="#80a55b">
        <block type="initpwmled"></block>
        <block type="initmotor"></block>
        <block type="initbutton"></block>
        <block type="initmotionsensor"></block>
        <block type="initdistancesensorbasic"></block>
        <block type="initdistancesensor">
            <field name="max_distance">1</field>
            <field name="threshold_distance">0.2</field>
        </block>
        <block type="initled"></block>
        <block type="initrobot"></block>
        <block type="initlightsensor"></block>
        <block type="initrgbled"></block>
        <block type="initbasicoutputdevice">
            <field name="activeHighValue">yes</field>
        </block>
        <block type="initcputemperature"></block>
        <block type="initledbargraph">
            <field name="pwmType">True</field>
        </block>
    </category>
    <category name="GZ - set const" colour="#5ba5a5">
        <block type="setled">
            <field name="whatToDo">on()</field>
        </block>
        <block type="setpwmled">
            <field name="pwmValue">0</field>
        </block>
        <block type="setrgbledcolor">
            <field name="valueOfRed">0</field>
            <field name="valueOfGreen">0</field>
            <field name="valueOfBlue">0</field>
        </block>
        <block type="setseparateledofrgbledtocolorintensity">
            <field name="colorChooser">red</field>
            <field name="intensity">0</field>
        </block>
        <block type="operationofrobot">
            <field name="operation">forward()</field>
        </block>
        <block type="operationofmotor">
            <field name="operation">forward()</field>
        </block>
        <block type="setbasicoutputdevicestate">
            <field name="state">on</field>
        </block>
    </category>
    <category name="GZ - set var" colour="#805ba5">
        <block type="setrgbledcolortovar">
            <field name="color">red</field>
        </block>
        <block type="setpwmledtovar"></block>
    </category>
    <category name="GZ - complex" colour="#a5805b">
        <block type="initrobotvacuumcleaner"></block>
        <block type="vacuumcleanerhandler"></block>
        <block type="initpetfeeder"></block>
        <block type="petfeederhandler"></block>
        <block type="initrobberdetector"></block>
        <block type="robberdetectorhandler"></block>
    </category>
    <category name="GZ - bool" colour="#5ba55b">
        <block type="isbuttonpressed"></block>
        <block type="istheremotion"></block>
    </category>
    <category name="GZ - wait" colour="#5b80a5">
        <block type="waitforbuttonpressed"></block>
        <block type="waitforlight"></block>
        <block type="waitfordark"></block>
    </category>
    <category name="GZ - value" colour="#a55ba5">
        <block type="lightsensorvalue"></block>
        <block type="distancesensorvalue"></block>
        <block type="getcputempvalue"></block>
        <block type="getvalues"></block>
        <block type="setvalueoffield"></block>
        <block type="cputemperaturesinglevalue"></block>
    </category>
</div>

<script>
    /*Blockly related*/
    var toolbox = document.getElementById("toolbox");
    var options = {
        toolbox: toolbox,
        collapse: true,
        comments: true,
        disable: true,
        maxBlocks: Infinity,
        trashcan: true,
        horizontalLayout: false,
        toolboxPosition: 'start',
        css: true,
        media: 'https://blockly-demo.appspot.com/static/media/',
        rtl: false,
        scrollbars: true,
        sounds: true,
        oneBasedIndex: false,
        grid: {
            spacing: 20,
            length: 1,
            colour: '#888',
            snap: false
        },
        zoom: {
            controls: true,
            wheel: true,
            startScale: 1,
            maxScale: 3,
            minScale: 0.3,
            scaleSpeed: 1.2
        }
    };
    var blocklyArea = document.getElementById('blocklyArea');
    var blocklyDiv = document.getElementById('blocklyDiv');
    var demoWorkspace = Blockly.inject(blocklyDiv, options);
    var onResize = function (e) {
        // Compute the absolute coordinates and dimensions of blocklyArea.
        var element = blocklyArea;
        var x = 0;
        var y = 0;
        do {
            x += element.offsetLeft;
            y += element.offsetTop;
            element = element.offsetParent;
        } while (element);
        // Position blocklyDiv over blocklyArea.
        blocklyDiv.style.left = x + 'px';
        blocklyDiv.style.top = y + 'px';
        blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
        blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
    };

    window.addEventListener('resize', onResize, false);
    onResize();
    Blockly.svgResize(demoWorkspace);
    demoWorkspace.addChangeListener(updateRealTimeBlockToPythonConversionTextarea);

    /*User related*/
    document.getElementById('file-input').addEventListener('change', readSingleFile, false);
</script>
</body>
</html>
